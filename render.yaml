services:
  - type: web
    name: deception-api
    runtime: python
    region: oregon
    plan: free

    # Install PyTorch CPU-only first, then deps, then pre-download HF models
    # into model_cache/ (persists from build â†’ runtime, no 512 MB spike at boot)
    buildCommand: >-
      pip install torch --index-url https://download.pytorch.org/whl/cpu &&
      pip install -r requirements.txt &&
      python predownload.py

    # Render injects $PORT automatically
    startCommand: uvicorn app:app --host 0.0.0.0 --port $PORT --workers 1

    envVars:
      - key: SUPABASE_URL
        sync: false          # enter manually in Render dashboard
      - key: SUPABASE_KEY
        sync: false
